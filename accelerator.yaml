accelerator:
  displayName: Function Buildpacks Accelerator
  description: Generates templates for Function Buildpacks for Knative
  iconUrl: https://raw.githubusercontent.com/bbtong/functions-accelerator/main/functions-icon.png
  tags:
    - Functions
    - Python
    - Java
    - Serverless

  options:
  - name: select
    inputType: select
    display: true
    description: Select a language and event type
    defaultValue: languagePythonHTTP
    choices:
      - text: Python HTTP
        value: languagePythonHTTP
      - text: Python CloudEvents
        value: languagePythonCE
      - text: Java HTTP
        value: languageJavaHTTP
      - text: Java CloudEvents
        value: languageJavaCE
  - name: includeTap
    label: "Include TAP deployment resources?"
    inputType: checkbox
    dataType: boolean
    defaultValue: true

engine:
  merge:
  # Core files
  - include: ["LICENSE", "NOTICE", "DEPLOYING.md", "catalog/**", "config/**"]
    exclude: ["buildpacks/**", "invokers/**", "samples/**", "tests"]
  # Java CE
  - condition: "#select == 'languageJavaCE'"
    include: ["templates/java/cloudevents-gradle/*", "templates/java/cloudevents-maven/*"]
    chain:
    - type: RewritePath
      rewriteTo: "#g0"
  # Java HTTP
  - condition: "#select == 'languageJavaHTTP'"
    include: ["templates/java/http-gradle/*", "templates/java/http-maven/*"]
    chain:
    - type: RewritePath
      rewriteTo: "#g0"
  # Python CE
  - condition: "#select == 'languagePythonCE'"
    include: ["templates/python/cloudevents/**"]
    chain:
    - type: RewritePath
      rewriteTo: "#filename"
  # Python HTTP
  - condition: "#select == 'languagePythonHTTP'"
    include: ["templates/python/http/**"]
    chain:
    - type: RewritePath
      rewriteTo: "#filename"
  # TAP files
  - include: [ "config/workload.yaml" ]
    condition: "#includeTap"
    chain:
    - type: ReplaceText
      substitutions:
      - text: node-express
        with: "#artifactId"
  - include: [ "catalog/catalog-info.yaml" ]
    condition: "#includeTap"
    chain:
    - type: ReplaceText
      substitutions:
      - text: node-express
        with: "#artifactId"